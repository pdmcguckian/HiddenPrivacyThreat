<!doctype html>
<html>

<head>
	<meta charset="UTF-8">
	<title>P. D. McGuckian | SIoT Dashboard</title>

	<meta property="og:title" h_footercontent='Hidden Threat | SIoT'/>
    <meta name="viewport" content="width=device-width, initial-scale=0.86, maximum-scale=3.0, minimum-scale=0.86">

	<link rel="stylesheet" href="pdmcguckian.css">
	<link rel="stylesheet" href="https://use.typekit.net/jcz8ueb.css">

	<link rel="icon" href="/favicon.ico">
	<link rel="apple-touch-icon" href="/favicon192.png">
	
	<!-- The core Firebase JS SDK is always required and must be listed first -->
	<script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-app.js"></script>

	<!-- TODO: Add SDKs for Firebase products that you want to use
		https://firebase.google.com/docs/web/setup#available-libraries -->
	<script src="https://www.gstatic.com/firebasejs/7.19.0/firebase-analytics.js"></script>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>

	<script>
	// Your web app's Firebase configuration
	var firebaseConfig = {
		apiKey: "AIzaSyDLV7i3s09cZ19wyP1AP1SdeTqNyP3jnX0",
		authDomain: "portfolio-36a49.firebaseapp.com",
		databaseURL: "https://portfolio-36a49.firebaseio.com",
		projectId: "portfolio-36a49",
		storageBucket: "portfolio-36a49.appspot.com",
		messagingSenderId: "886630373892",
		appId: "1:886630373892:web:4d62d4625d110d5315f351",
		measurementId: "G-H76XH15R9E"
	};
	// Initialize Firebase
	firebase.initializeApp(firebaseConfig);
	firebase.analytics();
	</script>	

</head>

<body>

	<div class="h_cardheader">
		<div id="aboutcard" class="cardhover" onmouseover="projectCards(0)"><p>About</p></div>
		<div id="truedatacard" class="card" onmouseover="projectCards(2)"><p>True Data</p></div>
		<div id="predictionscard" class="card" onmouseover="projectCards(1)"><p>Predictions</p></div>
	</div>


	<div class="h_main" id="desktop">
		<div class="h_about" id="about">
			
			<div class="h_headersection">
				<div><h1>About</h1></div>
				<div class="h_datebuttons">
					<a class="buttons" style="margin-right: 10px;" href="#" onclick="change_date(-1);"><p>Day Back</p></a>
					<h6 id="date1"></h6>
					<a class="buttons" style="margin-left: 10px;" href="#" onclick="change_date(1);"><p>Day Forward</p></a>
				</div>
			</div>
			
			<div class="h_aboutcontent">
				<div class="h_halfcol">
					<h5>Modern smart home IoT products provide us with convenience and utility. However they absoloutely destory our right to privacy. Already, Google is using your smart home data to <b>target adds</b> and one day they may start <b>selling it to third parties like insuraners or recuriters.</b></h5>
					<h5>You might think this isn't a problem, as companies like Google typically <b>encrypt the audio and video data</b> leaving devices, meaning they can't see what your doing.</h5>
					<h5>This may be true, but <b>they can still record devide 'meta data'</b> (e.g. when it's turned on, sending data etc.).When you have enough devices in your house this simple data can be used to infer incredibly sensitive information about you.
					<h5>To prove this <b>I have simulated smart home meta data collection and am using it to try predict senstive information about me.</b> To see how watch the video.</h5>
					<h5>So far I have been able to <b>predict sleep quality and alcohol consumption to a XX% and XX% accuracy</b>, and I am only a month in. Over the next few months I will keep adding prediction metrics to this site.</h5>
				</div>

				<div class="h_halfcol">
					<div class="h_introvideoboarder">
						<div id="h_projectvideo">
							<video controls class="h_video">
								<source src="opaque_main.mp4" type="video/mp4">
							</video>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="h_predictions" id="predictions">
			<div class="h_headersection">
				<div><h1>Predictions</h1></div>
				<div class="h_datebuttons">
					<a class="buttons" style="margin-right: 10px;" href="#" onclick="change_date(-1);"><p>Day Back</p></a>
					<h6 id="date2"></h6>
					<a class="buttons" style="margin-left: 10px;" href="#" onclick="change_date(1);"><p>Day Forward</p></a>
				</div>
			</div>
			<h2>Room Prediction</h2>
			<div class="h_predictionscontent">
				<div class="h_80col" style="height: 550px">
					<canvas id="roomlocation" style="width:80%"></canvas>
				</div>
				<div class = "h_20col">
					<div>
						<h2 id="timeIn">Time In - </h2>
						<h2 id="BedroomTime" style="color: rgb(33,42,53)";>Bedroom: </h2>
						<h2 id="KitchenTime" style="color: rgb(160,160,160);">Kitchen: </h2>
						<h2 id="LivingRoomTime" style="color: rgb(132,60,11);">Living Room: </h2>
					</div>
					<div class="h_pred_col_card">
						<h4>Sleep Quality</h4>
						<h4 id="sleepQualityPrediction"></h4>
					</div>
					<div class="h_pred_col_card">
						<h4>Alcohol Consumed</h4>
						<h4 id="alcoholPrediction"></h4>
					</div>
				</div>
			</div>
	
		</div>


		<div class="h_truedata" id="truedata">
			<div class="h_headersection">
				<div><h1>True Data</h1></div>
				<div class="h_datebuttons">
					<a class="buttons" style="margin-right: 10px;" href="#" onclick="change_date(-1);"><p>Day Back</p></a>
					<h6 id="date3"></h6>
					<a class="buttons" style="margin-left: 10px;" href="#" onclick="change_date(1);"><p>Day Forward</p></a>
				</div>
			</div>
			<div class="h_truedatacontent">
				<div class="h_halfcol" style="height: 250px">
					<h2>Bedroom BLE Data</h2>
					<canvas id="bedroom" style="width:45%"></canvas>
					<h2>Living Room BLE Data</h2>
					<canvas id="livingroom" style="width:45%"></canvas>
				</div>
				<div class="h_halfcol" style="height: 250px">
					<h2>Kitchen BLE Data</h2>
					<canvas id="kitchen" style="width:45%"></canvas>
					<h2>Event Data</h2>
					<div class="h_truedatacontent">
						<div class="h_halfcol">
							<div class="h_col_card">
								<h4>Sleep Quality</h4>
								<h4 id="sleepquality"></h4>
							</div>
						</div>
						<div class="h_halfcol">
							<div class="h_col_card">
								<h4>Alcohol Consumed</h4>
								<h4 id="alcoholconsumed"></h4>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	





	<div class="h_main_mob" id="mobile">
		
	</div>

</body>	

<script>
	function projectCards(section) {
		var about = document.getElementById("about");
		var predictions = document.getElementById("predictions");
		var truedata = document.getElementById("truedata");

		document.getElementById("aboutcard").className = "card";
		document.getElementById("predictionscard").className = "cardhover";
		document.getElementById("truedatacard").className = "card";
		
		if (section===0) {
			about.style.display = "flex";
			predictions.style.display = "none";
			truedata.style.display = "none";

			document.getElementById("aboutcard").className = "cardhover";
			document.getElementById("predictionscard").className = "card";
			document.getElementById("truedatacard").className = "card";
		}

		if (section===1) {
			about.style.display = "none";
			predictions.style.display = "flex";
			truedata.style.display = "none";

			document.getElementById("aboutcard").className = "card";
			document.getElementById("predictionscard").className = "cardhover";
			document.getElementById("truedatacard").className = "card";

			change_date_text();
			render_graphs();
			collect_events();

		}
		
		if (section===2) {
			about.style.display = "none";
			predictions.style.display = "none";
			truedata.style.display = "flex";

			document.getElementById("aboutcard").className = "card";
			document.getElementById("predictionscard").className = "card";
			document.getElementById("truedatacard").className = "cardhover";

			change_date_text();
			render_graphs();
			collect_events();
		}
}
</script>

<script>
	var dateControl = 15;
	var NextDate = 16;
	var date = new Date("November " + dateControl + ", 2021")
	var chart1 = new Chart("roomlocation", {});
	var chart2 = new Chart("bedroom", {});
	var chart3 = new Chart("livingroom", {});
	var chart4 = new Chart("kitchen", {});

	change_date_text();
	render_graphs();
	collect_events();
	charts_drawn = false;

	function change_date(direction) {

		chart1.destroy();
		chart2.destroy();
		chart3.destroy();
		chart4.destroy();

		dateControl = dateControl + direction;
		NextDate = dateControl + 1;

		if (dateControl < 12 && dateControl > 10) {
			dateControl = 12;
			NextDate = 13;
		}

		else if (dateControl < 8 && dateControl > 4) {
			dateControl = 4;
			NextDate = 5;
		}

		else if (dateControl == 31) {
			dateControl = 1;
			NextDate = 2;
		}

		else if (dateControl == 0) {
			dateControl = 30;
			NextDate = 1;
		}

		if (dateControl > 4) {
			date = new Date("November " + dateControl + ", 2021")
		}

		else {
			date = new Date("December " + dateControl + ", 2021")
		}

		change_date_text();
		render_graphs();
		collect_events();}

	function change_date_text(direction) {
		document.getElementById('date1').innerHTML = date.toISOString().substring(0, 10) + " - " + (NextDate);
		document.getElementById('date2').innerHTML = date.toISOString().substring(0, 10) + " - " + (NextDate);
		document.getElementById('date3').innerHTML = date.toISOString().substring(0, 10) + " - " + (NextDate);
	}


	async function render_graphs() {
		var pushDate = date.toISOString().substring(0, 10);
		const javaScriptRelease = Date.parse(pushDate)/1000;
		var data = {
			date: javaScriptRelease
    	};
		var json = JSON.stringify(data);

		var xValues = [];

		//Prediction Values
		var ktchnBool = [];
		var bdrmBool = [];
		var lvngrmBool = [];
		var wyBool = [];

				//Prediction Values
		var ktchnValues = [];
		var bdrmValues = [];
		var lvngrmValues = [];

		
		var requestURL = "https://webhooks.mongodb-realm.com/api/client/v2.0/app/predictor-rjhbq/service/sendWebApp/incoming_webhook/webhook_collectBLE?secret=SIoT";
		var xhr = new XMLHttpRequest();
		xhr.open("POST", requestURL);
		xhr.setRequestHeader("Accept", "application/json");
		xhr.send(json);

		xhr.onreadystatechange = function () {
		if (xhr.readyState === 4) {
			var collectedBLEData = JSON.parse(xhr.responseText);
			for(var i = 0; i < collectedBLEData.length; i++) {

				var obj = collectedBLEData[i];
				
				try {

					//Collect Values
					bdrmRSSI = Number(obj.rssiBDRM.$numberInt);
					lvngrmRSSI = Number(obj.rssiLVNGRM.$numberInt);
					ktchnRSSI = Number(obj.rssiKTCHN.$numberInt);

					var time = new Date(obj.timeStampID.$numberInt*1000).toISOString().substring(11, 16);
					ktchnValues.push(ktchnRSSI);
					lvngrmValues.push(lvngrmRSSI);
					bdrmValues.push(bdrmRSSI);
					xValues.push(time);

				}
				catch(err) {
				}

			}

			var smooth_bdrm = [];
			var smooth_lvngrm = [];
			var smooth_ktchn = [];

			for (var i = 1; i < ktchnValues.length-1; i++)
			{
				var mean = (bdrmValues[i] + bdrmValues[i-1] + bdrmValues[i+1] + bdrmValues[i-2] + bdrmValues[i+2] + bdrmValues[i-3] + bdrmValues[i+3])/7.0;
				smooth_bdrm.push(mean);

				var mean = (lvngrmValues[i] + lvngrmValues[i-1] + lvngrmValues[i+1] + lvngrmValues[i-2] + lvngrmValues[i+2] + lvngrmValues[i-3] + lvngrmValues[i+3])/7.0;
				smooth_lvngrm.push(mean);

				var mean = (ktchnValues[i] + ktchnValues[i-1] + ktchnValues[i+1] + ktchnValues[i-2] + ktchnValues[i+2] + ktchnValues[i-3] + ktchnValues[i+3])/7.0;
				smooth_ktchn.push(mean);
			}

			for (var i = 0; i < ktchnValues.length; i++) {
				bdrmRSSI = smooth_bdrm[i]
				lvngrmRSSI = smooth_lvngrm[i]
				ktchnRSSI = smooth_ktchn[i]

				//Prediction Graphs
				if (bdrmRSSI == -100 && lvngrmRSSI == -100 && ktchnRSSI == -100) {
					ktchnBool.push(0);
					lvngrmBool.push(0);
					bdrmBool.push(0);
					wyBool.push(1);
				}

				else if (ktchnRSSI >= bdrmRSSI && ktchnRSSI >= lvngrmRSSI) {
					ktchnBool.push(1);
					lvngrmBool.push(0);
					bdrmBool.push(0);
					wyBool.push(0);
				}

				else if (lvngrmRSSI >= bdrmRSSI && lvngrmRSSI >= ktchnRSSI) {
					ktchnBool.push(0);
					lvngrmBool.push(1);
					bdrmBool.push(0);
					wyBool.push(0);
				}

				else if (bdrmRSSI >= ktchnRSSI && bdrmRSSI >= lvngrmRSSI) {
					ktchnBool.push(0);
					lvngrmBool.push(0);
					bdrmBool.push(1);
					wyBool.push(0);
				}
			}


			minutes_not_in = wyBool.reduce((partial_sum, a) => partial_sum + a, 0)
			if (minutes_not_in >= 1339) {
				document.getElementById('sleepQualityPrediction').innerHTML = "N/a";
				document.getElementById('alcoholPrediction').innerHTML = "N/a";
				document.getElementById('alcoholconsumed').innerHTML = "N/a";
				document.getElementById('sleepquality').innerHTML  = "N/a";
				document.getElementById('timeIn').innerHTML = "Time In: N/a";
				document.getElementById('LivingRoomTime').innerHTML = "Living Room: N/a";
				document.getElementById('KitchenTime').innerHTML = "Kitchen: N/a";
				document.getElementById('BedroomTime').innerHTML  = "Bedroom: N/a";
			}

			else {
				make_predictions(ktchnBool, lvngrmBool, bdrmBool);
			}

			var chart2 = new Chart("roomlocation", {
			type: "line",
			data: {
				labels: xValues,
				datasets: [{
				borderColor: "rgb(33,42,53)",
				data: bdrmBool,
				borderWidth: 5
				
				},{
				borderColor: "rgb(160,160,160)",
            	fill: 1,
				data: ktchnBool,
				borderWidth: 5
				
				},{

				borderColor: "rgb(132,60,11)",
            	fill: 1,
				data: lvngrmBool,
				borderWidth: 5

				
				}]
	
			},
			options: {
				legend: {display: false},
				animation: {duration: 0},
				tooltips: {enabled: false},
				hover: {mode: null},
				maintainAspectRatio: false,
			}
			});

			var chart2 = new Chart("bedroom", {
			type: "line",
			data: {
				labels: xValues,
				datasets: [{
				data: bdrmValues,
				borderColor: "rgb(33,42,53)",
				fill: false
				}]
			},
			options: {
				legend: {display: false},
				animation: {duration: 0},
				tooltips: {enabled: false},
				hover: {mode: null},
				maintainAspectRatio: false
			}
			});

			var chart3 = new Chart("livingroom", {
			type: "line",
			data: {
				labels: xValues,
				datasets: [{
				data: lvngrmValues,
				borderColor: "rgb(132,60,11)",
				fill: false
				}]
			},
			options: {
				legend: {display: false},
				animation: {duration: 0},
				tooltips: {enabled: false},
				hover: {mode: null},
				maintainAspectRatio: false,
			}
			});

			var chart4 = new Chart("kitchen", {
			type: "line",
			data: {
				labels: xValues,
				datasets: [{
				data: ktchnValues,
				borderColor: "rgb(160,160,160)",
				fill: false
				}]
			},
			options: {
				legend: {display: false},
				animation: {duration: 0},
				tooltips: {enabled: false},
				hover: {mode: null},
				maintainAspectRatio: false
			}
			});

		}};
	}


	async function collect_events() {
		var pushDate = date.toISOString().substring(0, 10);
		const javaScriptRelease = Date.parse(pushDate)/1000;
		var data = {
			date: javaScriptRelease
    	};
		var json = JSON.stringify(data);

		var xValues = [];

		//Prediction Values
		var ktchnBool = [];
		var bdrmBool = [];
		var lvngrmBool = [];
		var wyBool = [];

				//Prediction Values
		var ktchnValues = [];
		var bdrmValues = [];
		var lvngrmValues = [];

		
		var requestURL = "https://webhooks.mongodb-realm.com/api/client/v2.0/app/predictor-rjhbq/service/sendWebApp/incoming_webhook/webhook_collectFITBIT?secret=SIoT";
		var xhr = new XMLHttpRequest();
		xhr.open("POST", requestURL);
		xhr.setRequestHeader("Accept", "application/json");
		xhr.send(json);

		xhr.onreadystatechange = function () {
		if (xhr.readyState === 4) {
			var collectedEventData = JSON.parse(xhr.responseText);
			console.log(collectedEventData)
			//Collect Values
			sleepQuality = collectedEventData[0].SleepEfficiency.$numberInt;
			if (sleepQuality == undefined) {
				sleepQuality = collectedEventData[0].SleepEfficiency.$numberLong;
			}
			AlcoholConsumed = collectedEventData[0].AlcoholConsumed;

			if (AlcoholConsumed) {
			document.getElementById('alcoholconsumed').innerHTML = "Yes";
			}
			else {
			document.getElementById('alcoholconsumed').innerHTML = "No";
			}

			if (sleepQuality > 84) {
			document.getElementById('sleepquality').innerHTML  = "Good";
			}
			else {
			document.getElementById('sleepquality').innerHTML = "Poor";
			}
	}}}


	async function make_predictions(ktchnBool, lvngrmBool, bdrmBool) {
		ktchnTime = ktchnBool.reduce((partial_sum, a) => partial_sum + a, 0)
		lvngrmTime = lvngrmBool.reduce((partial_sum, a) => partial_sum + a, 0)
		bdrmTime = bdrmBool.reduce((partial_sum, a) => partial_sum + a, 0)
		timeIn = 0;

		for (let i = 0; i < 1440; i++) { 
			if (ktchnBool[i] == 1 || lvngrmBool[i] == 1 || bdrmBool[i] == 1) {
				timeIn = i;
				break
			}
			}
		
		y_sleep = -0.012*timeIn -0.00382*lvngrmTime+ 0.015*bdrmTime +  0.00206 * ktchnTime-1.81;
		y_alcohol = 0.0189*timeIn + 0.0599*lvngrmTime + 0.0173*bdrmTime +0.0916*ktchnTime-27.51;

		if (y_sleep < 0) {
			document.getElementById('sleepQualityPrediction').innerHTML = "Poor";
		}
		else {
			document.getElementById('sleepQualityPrediction').innerHTML = "Good";
		}

		if (y_alcohol < 0) {
			document.getElementById('alcoholPrediction').innerHTML = "No";
		}
		else {
			document.getElementById('alcoholPrediction').innerHTML = "Yes";
		}

		document.getElementById('timeIn').innerHTML = "Time In: " + timeIn;
		document.getElementById('LivingRoomTime').innerHTML = "Living Room: " + lvngrmTime;
		document.getElementById('KitchenTime').innerHTML = "Kitchen: " + ktchnTime;
		document.getElementById('BedroomTime').innerHTML  = "Bedroom: " + bdrmTime;

		}


</script>





</html>